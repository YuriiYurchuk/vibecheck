generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  image         String?
  emailVerified Boolean   @default(false)
  timezone      String    @default("UTC")
  lastSyncedAt  DateTime? @db.Timestamptz
  isSyncing     Boolean   @default(false)
  lastActiveAt  DateTime  @default(now()) @db.Timestamptz
  createdAt     DateTime  @default(now()) @db.Timestamptz
  updatedAt     DateTime  @updatedAt @db.Timestamptz
  sessions      Session[]
  accounts      Account[]
  playHistory   PlayHistory[] 

  @@map("users")
}

model Session {
  id                    String @id @default(cuid())
  expiresAt             DateTime @db.Timestamptz
  token                 String @unique
  userId                String
  ipAddress             String?
  userAgent             String? 
  user                  User @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt             DateTime @default(now()) @db.Timestamptz
  updatedAt             DateTime @updatedAt @db.Timestamptz

  @@index([userId])
  @@map("sessions")
}

model Account {
  id                    String @id @default(cuid())
  userId                String 
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime? @db.Timestamptz
  refreshTokenExpiresAt DateTime? @db.Timestamptz
  scope                 String?
  hasError              Boolean   @default(false)
  lastError             String?
  lastErrorAt           DateTime? @db.Timestamptz
  createdAt             DateTime @default(now()) @db.Timestamptz
  updatedAt             DateTime @updatedAt @db.Timestamptz
  user                  User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("accounts")
}

model Verification {
  id                    String @id @default(cuid())
  identifier            String
  value                 String
  expiresAt             DateTime @db.Timestamptz
  createdAt             DateTime @default(now()) @db.Timestamptz
  updatedAt             DateTime @updatedAt @db.Timestamptz
  
  @@unique([identifier, value])
  @@map("verifications")
}

model Artist {
  id                    String @id
  name                  String
  imageUrl              String?
  href                  String?
  tracks                TrackArtist[]
  createdAt             DateTime @default(now()) @db.Timestamptz
  updatedAt             DateTime @updatedAt @db.Timestamptz

  @@index([name])
  @@map("artists")
}

model Track {
  id                    String @id
  name                  String
  imageUrl              String?
  durationMs            Int
  href                  String?
  acousticness          Float?
  danceability          Float?
  energy                Float?
  instrumentalness      Float?
  key                   Int?
  liveness              Float?
  loudness              Float?
  mode                  Int?
  speechiness           Float?
  tempo                 Float?
  valence               Float?
  artists               TrackArtist[]
  plays                 PlayHistory[]
  createdAt             DateTime @default(now()) @db.Timestamptz
  updatedAt             DateTime @updatedAt @db.Timestamptz

  @@index([name])
  @@map("tracks")
}

model TrackArtist {
  trackId               String
  artistId              String
  track                 Track  @relation(fields: [trackId], references: [id], onDelete: Cascade)
  artist                Artist @relation(fields: [artistId], references: [id], onDelete: Cascade)

  @@id([trackId, artistId])
  @@index([artistId])
  @@map("track_artists")
}

model PlayHistory {
  id                    String @id @default(cuid())
  userId                String
  trackId               String
  playedAt              DateTime @db.Timestamptz
  user                  User @relation(fields: [userId], references: [id], onDelete: Cascade)
  track                 Track @relation(fields: [trackId], references: [id], onDelete: Cascade)
  createdAt             DateTime @default(now()) @db.Timestamptz

  @@unique([userId, trackId, playedAt])
  @@index([userId, playedAt, trackId])
  @@map("play_history")
}